server {
    listen 80;
    listen [::]:80;

    # Use OpenResty's /etc/resolv.conf parsing capability.  This
    # however does not include the 'search' directives but only the
    # 'nameserver' ones (it seems). For this reason it appears like
    # the best option is to always try to resolve FQDN instead of
    # partial ones, like "my-service".
    #
    # See: https://groups.google.com/g/openresty-en/c/jIrpyTYgSVA and
    # also the OpenResty source code itself.
    resolver local=on;

    location / {
        proxy_pass http://$http_host$uri$is_args$args;
        access_by_lua_file /app/access.lua;
    }
}
